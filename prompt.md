# PowerPoint自動生成アドイン - 改良版開発仕様

## プロジェクト概要

https://github.com/sumikof-ai/powerpoint-concierge.git のリポジトリをベースに、チャット入力からOpenAI APIを活用してPowerPointプレゼンテーションを自動生成するOfficeアドインを開発する。

## 核心機能要件

### 1. チャット入力とAPI連携

- **入力処理**: ユーザーがサイドパネルのチャット欄に要件を入力
- **API呼び出し**: 設定可能なOpenAI API（デフォルトGPT-4）にリクエスト送信
- **レスポンス処理**: API応答を解析してPowerPoint操作用のデータに変換

### 2. 段階的プレゼンテーション作成フロー

```
Step 1: アウトライン生成 → Step 2: 確認・修正 → Step 3: スライド生成 → Step 4: 個別編集
```

#### Step 1: アウトライン自動生成

入力内容から以下の構造化されたアウトラインを生成：

```json
{
  "title": "プレゼンテーションタイトル",
  "slides": [
    {
      "slideNumber": 1,
      "title": "スライドタイトル",
      "content": ["要点1", "要点2", "要点3"],
      "slideType": "title|content|conclusion"
    }
  ],
  "estimatedDuration": "想定発表時間（分）"
}
```

#### Step 2: アウトライン確認・修正UI

- 生成されたアウトラインをツリー表示
- インラインで編集可能（タイトル、要点の追加・削除・並び替え）
- 「このアウトラインで作成開始」ボタン
- 「AIに再生成を依頼」機能（追加指示入力可能）

#### Step 3: 自動スライド生成

- アウトラインに基づいて複数スライドを一括生成
- 進捗表示（「スライド 3/10 作成中...」）
- 各スライドの内容：
  - タイトル（編集可能テキスト）
  - 本文（箇条書き、編集可能テキスト）
  - 適切なレイアウト自動選択

#### Step 4: 個別スライド編集

- スライド一覧表示（サムネイル付き）
- 特定スライドを選択して再編集
- 編集指示の自由入力（「このスライドをもっと詳しく」等）

### 3. PowerPoint操作仕様

- **対象**: 現在開いているPowerPointファイルを直接編集
- **保存**: ユーザーが手動で「名前を付けて保存」
- **テキスト形式**: すべてのテキストは編集可能な形式で挿入（画像化しない）
- **レイアウト**: PowerPointの標準レイアウトを活用

## 技術仕様

### 開発環境

- **フレームワーク**: Yeoman generator + TypeScript + React（またはNext.js）
- **Officeアドイン**: Office.js API
- **スタイリング**: Fluent UI Reactコンポーネント
- **状態管理**: React Context + useReducer

### 設定管理

```typescript
interface AppConfig {
  openai: {
    baseUrl: string;        // デフォルト: "https://api.openai.com/v1"
    apiKey: string;         // 環境変数から取得
    model: string;          // デフォルト: "gpt-4"
    maxTokens: number;      // デフォルト: 2000
  };
  ui: {
    theme: 'light' | 'dark';
    language: 'ja' | 'en';
  };
}
```

### エラーハンドリング要件

- API接続エラー時の適切なメッセージ表示
- レート制限時のリトライ機能
- PowerPoint操作失敗時のロールバック
- ネットワーク切断時の自動復旧

## 実装優先順位

### Phase 1: 基盤機能

1. サイドパネルUI構築
2. OpenAI API連携（設定読み込み含む）
3. 基本的なPowerPoint操作（スライド追加、テキスト挿入）

### Phase 2: コア機能

1. アウトライン生成機能
2. アウトライン編集UI
3. 複数スライド一括生成

### Phase 3: 高度機能

1. 個別スライド編集
2. エラーハンドリング
3. パフォーマンス最適化

## コード品質要求

### TypeScript実装

- 厳密な型定義（strict mode有効）
- インターフェース設計の明確化
- エラー型の適切な定義

### テスト要件

- ユニットテスト（Jest + React Testing Library）
- E2Eテスト（Playwright）
- API mock機能

### パフォーマンス

- スライド生成の非同期処理
- 大量スライド作成時のメモリ効率
- UI応答性の維持

## セキュリティ要件

- API キーの安全な保存（暗号化）
- HTTPS通信の強制
- 入力値の適切なサニタイゼーション

## 開発する際の注意点

1. Office.js APIの非同期処理を適切にハンドリング
2. PowerPointのバージョン互換性を考慮
3. リアルタイムでのユーザーフィードバック表示
4. 長時間処理時のタイムアウト対策
5. 日本語テキストの適切な処理

現在チャット入力およびOpenAI API連携とアウトライン生成機能の実装が完成している状態から、段階的に機能を追加してください。各機能実装時は、エラーケースとユーザビリティを十分に考慮してください。